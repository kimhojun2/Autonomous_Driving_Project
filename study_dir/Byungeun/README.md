

### 프로젝트 명세서 학습 
- SUB PJT 1 : ROS 통신 프로토콜
- SUB PJT 2 : Localiztion/판단/제어 개발
- SUB PJT 3 : 인지/판단/제어 심화 (알고리즘 고도화)

---
- 프로젝트 역할 분담을 위해 개발 전체 과정을 파악하고 어떤 방식으로 어떻게 나눌 수 있을지에 대해 학습 및 판단

- 인지 vs 판단/제어 로 나눌 수 있어 보임. 

    - 인지 : 인지 알고리즘은 자율주행 시스템의 가장 시작부분으로 볼 수 있다.
    인지의 알고리즘 성능이 보장돼야 이후 프로세스를 안정적으로 개발할 수 있다. GPS/라이다/카메라 센서에 대해 학습하고 데이터를 획득, 가공해야한다. 가공된 데이터를 통해 차선/정지선/신호등 인식 등의 물체인식을 통해 판단/제어 알고리즘으로 데이터를 넘겨주는 통신코드를 개발한다. 앞 단계로는 인지과정의 복잡성을 줄여 판단/제어 알고리즘 개발이 가능하도록 인지에 해당하는 값은 시뮬레이터에서 제공하는 참값을 사용할 수 있다.
    이후에는 알고리즘을 통해 카메라로 얻은 데이터를 영상처리하여 원하는 형태로 가공하거나 두개의 센서를 융합하는 센서 퓨전등을 통해 데이터를 가공한다. 
    
    - 판단/제어 : 시뮬레이터에서 제공하는 정보나 인지 알고리즘에서 인식된 물체의 정보를 넘겨받아 현재 움지여야 하는 속도/ 방향을 결정하여 차량을 제어하는 역할을 한다. 
    판단/제어 알고리즘은 자율주행 차량 시스템의 마지막 관문으로써 차량의 움직임을 결정한다. 
    차량의 스티어링 및 속도 제어기를 설계하고 이를 응용하여 차선변경 알고리즘을 개발한다. 




## 최단경로 알고리즘 학습
    - 사전지식 
        - 힙(최대힙, 최소힙)
        - 우선순위 큐

    - 다익스트라 알고리즘
        - 힙, 우선순위 큐를 활용하여 최단 경로 리스트를 만들어 결과값을 산출해냄.
        - 백준 1916, 14284, 18223 풀이 완료
    

## 프로젝트 명세 학습
    ```
        sub pjt 2 
    1. 위치 인식 (2)
        - Localization, Odometry, ROS TF
    2. 정밀도로 지도 (1)
        - Mgeo				기능 상세 및 과제 기준 
                인지			25%
    ---------------------------
                판단/제어		75%
    3. 경로 계획 (4)
        - Odometry 경로 기록, 전역경로 생성, 지역경로 생성, 알고지름 전역경로
    4. 판단/제어 (5)
        - Pure pursuit 횡 제어, PID 종 제어, 속도 계획, 강화 pure pursuit, Adaptive Cuise Control




    sub pjt 3
    1. 판단/제어 고급(2)
        - 차선 변경
        - 장애물 파악, 충돌 회피
                판단/제어		30 %
    -------------------------------				
                인지			70 %
    2. 인지 과정 (5)
        - 카메라 센서 차선, 보행자 인식
        - 라이다 물체 인식, 비주얼화
        - 카메라 + 라이다 Calibration

    -------------------------------
                통합
    3. 인지/판단/제어 통합 (2)
        - 차선변경 to 라이다
        - 회피 to 라이다
        ```
    


### 24.04.04 
### 구현 내용 정리
---
- 충돌 회피 (Collision Avoidance) - 정적 장애물
    - 충돌 회피 : 충돌 회피는 주행 경로 상 장애물(Obstacle)이 있을 경우 이를 회피 할 수 있도록 경로를 생성하고 장애물과의 충돌을 회피하면서 전역 경로를 따라 정상적으로 운행하도록 하는 기능이다.
    - 충돌 회피 과정
        1. 경로 생성
        2. 경로 선택
    
    ### (충돌 회피 과정에는 가장 먼저 인지 단계에서 넘어오는 Object_data를 활용한다.)
    
    ### 1. 경로 생성
    
    - 경로 생성의 경우 다양한 방법들 중 격자(Lattice)점을 이용한 경로 생성 방법을 채택.
        - 격자점을 이용하는 이유
            
            ### **1. 예측 가능성과 일관성**
            
            - **격자 기반의 구조**는 미리 정의된 경로 패턴을 사용하기 때문에, 경로 결정의 예측 가능성과 일관성을 제공합니다. 이는 시스템이 예상 가능한 방식으로 반응하게 하며, 시뮬레이션과 실제 운행에서의 일관된 성능을 달성할 수 있게 합니다.
            
            ### **2. 최적화와 효율성**
            
            - **격자점을 활용한 경로 계획**은 고정된 경로 옵션들 사이에서 최적의 경로를 선택하므로, 계산 효율성이 높습니다. 경로 선택 과정에서의 계산량을 줄일 수 있으며, 이는 특히 실시간 시스템에서 중요한 이점입니다.
            
            ### **3. 복잡한 환경에서의 유연성**
            
            - **다양한 운행 환경에 적용 가능**: 격자점 방식은 다양한 운행 환경과 도로 조건에 대해 유연하게 적용될 수 있습니다. 격자의 밀도와 형태를 조정함으로써, 복잡한 환경이나 다양한 운행 조건에서도 효과적인 경로 계획이 가능합니다.
            
            ### **4. 안전성과 위험 회피**
            
            - **안전 거리 유지**: 격자 기반 경로는 장애물로부터 일정한 안전 거리를 유지하도록 설계될 수 있습니다. 이는 차량이 장애물을 회피하면서도 안전 마진을 유지할 수 있게 하여, 충돌 위험을 줄이는 데 도움이 됩니다.
            
            ### **5. 계획된 경로의 수정 용이성**
            
            - **동적 환경 대응**: 환경 변화에 따라 격자점 기반의 경로를 쉽게 수정하거나 재계획할 수 있습니다. 이는 동적인 도로 상황, 예를 들어 갑작스런 장애물 출현이나 교통 체증 발생 시 유연한 대응을 가능하게 합니다.
            
            ### **6. 정리**
            
            ### 높은 계산 효율성으로 실시간 시스템에서 유용하다는 점, 다양한 운행 환경, 조건에 유연하게 적용이 가능하고 쉽게 수정과 재계획이 가능하다는 장점들을 고려해 격자점을 이용한 경로 채택.
            
            ### 격자점 경로를 생성하는 데 있어 각 경로점을 잇는 경로의 조향각을 부드럽게 처리하도록 3차곡선 계획법을 활용한다.
            
    
    ### 2. 경로 선택
    
    1. 생성된 여러 경로들에 대해 안전성, 부드러움을 체크해 최적의 경로를 선택하도록 한다.
        1. 안전성의 경우 해당 경로에서 차량의 충돌 유무를 확인하는 것
       
            주행 경로의 point 들과 장애물 사이의 유클리드 거리(Euclidean distance)를 구하고 일정거리 이내 일 때, 충돌 위험이 있다고 판단해 가중치를 더해줌. 
            
        2. 부드러움의 경우 해당 경로의 조향각 변화량
          
            
            각 경로의 초기 가중치를 조향각 변화량 차이에 따라 3, 2, 1, 1, 2, 3 으로 선언 
            
        
        ### 정리 : 좌우로 3개씩 총 6개의 경로들에 대해 각 경로마다 충돌 여부를 유클리드 거리로 계산하고, 조향각 변화량을 함께 고려해 가중치를 부여한다. 가중치를 포함한 각 경로의 값들 중 가장 비용이 낮은 경로를 선택.  주행하게될 지역경로 데이터로 Publish한다.
    
        
    
    ### 충돌회피 - 보행자
    
    - 보행자의 경우 정적 장애물 과는 다르게, 차량 인지가 가능하고 움직임이 가능하기 때문에 차량입장에서 보행자의 패턴을 예측하는 데 한계가 있다. 뿐만 아니라 차량 주행에 있어 보행자와의 충돌은 인명사고의 위험도가 높다.
    - → 따라서 주행 경로상 보행자가 있어 충돌 위험이 있다고 판단될 경우 차량을 정지하고, 보행자가 경로에서 사라지면 다시 주행하도록 로직을 설계한다.
    - 경로와 보행자 위치를 받아와 각 경로점과 보행자의 유클리드 거리(Euclidean distance)를 계산하고 충돌 위험 여부를 판단한다. → 해당 여부를 Bool 값으로 Publish 하고 이를 주행 파일에서 구독해 Bool 값에 따라 정지 혹은 주행 하도록 설계.
        
        
    
    ### 정리 : 보행자의 경우 동적 장애물에 해당하고 차량입장에서 보행자의 패턴을 예측하는 데 한계가 있다. 뿐만 아니라 차량 주행에 있어 보행자와의 충돌은 인명사고의 위험도가 높다. 따라서 회피경로를 생성하지 않고 충돌 여부만을 판단해 Bool 값으로 데이터를 넘겨주어 보행자가 경로에서 사라지기 전까지 차량을 정지시킨다.
    

- ACC (Adaptive Cruise Control)
    
    ## 주행 - ACC
    
    Adaptive Cruise Control
    
    - 운전자(Ego)가 설정한 속도로 주행을 하다가 레이다, 라이다, 카메라 등과 같은 환경인지 센서로 앞차를 인지하고 앞차와의 간격을 유지하는 시스템
        
        
    
    - 차량의 현재 방향과 위치를 기준으로 로컬 좌표계로 변환하기 위한 변환 행렬(**`tmp_t`**)과 그 역행렬(**`tmp_det_t`**)을 계산한다.
    - 인지 파트에서 넘어오는 물체 정보 데이터 Object_topic 을 활용해 로컬 좌표계에서 선행 차량에 해당하는 차량을 판단한다. (Ego의 위치와 방향을 고려했을 때 가장 거리가 가까운 차량)
    - 선행 차량과의 상대 위치, 상대 속도 정보를 활용해 안전거리를 계산한다.
        - 안전거리 = 현재속도(ego_vel) * 시간간격(time_gap) + 기본 안전거리 (default_space)
    - 상대 속도 차이(**`vel_rel`**)와 거리 차이(**`dis_safe - dis_rel`**)를 이용해 가속도를 계산합니다. 속도 차이에 대한 이득(**`v_gain`**)과 거리 차이에 대한 이득(**`x_errgain`**)을 사용하여 최종 가속도를 결정
        
       